<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ñ–∏–ª—å | CalorieAI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è live BMI –≤–∏–¥–∂–µ—Ç–∞ */
.bmi-live-card {
    animation: pulse 2s infinite;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

@keyframes pulse {
    0% {
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    50% {
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }
    100% {
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
}

.bmi-live-card:hover {
    transform: scale(1.02);
    transition: transform 0.3s;
}

/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ */
#liveBMIMarker {
    transition: left 0.3s ease;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
}

/* –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ */
.form-control:focus + .input-hint {
    color: #667eea;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è */
#liveBMIContainer {
    animation: slideDown 0.5s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            font-weight: 700;
            font-size: 24px;
            text-decoration: none;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .nav-links {
            display: flex;
            gap: 15px;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ò–ú–¢ –∫–∞—Ä—Ç–æ—á–∫–∏ */
.bmi-card {
    animation: slideIn 0.5s ease;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.bmi-widget {
    transition: all 0.3s;
}

.bmi-widget:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}
        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .nav-link i {
            margin-right: 8px;
        }

        /* Flash —Å–æ–æ–±—â–µ–Ω–∏—è */
        .flash-messages {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 400px;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideInRight 0.3s ease;
            backdrop-filter: blur(10px);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .alert-success {
            background: rgba(209, 250, 229, 0.95);
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .alert-danger {
            background: rgba(254, 226, 226, 0.95);
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .alert-info {
            background: rgba(219, 234, 254, 0.95);
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }

        /* –ü—Ä–æ—Ñ–∏–ª—å */
        .profile-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 25px;
        }

        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .avatar-section {
            text-align: center;
            margin-bottom: 25px;
        }

        .avatar {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 48px;
            color: white;
            border: 4px solid white;
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .username {
            font-size: 20px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 5px;
        }

        .email {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .member-since {
            font-size: 12px;
            color: #94a3b8;
            padding: 8px 12px;
            background: #f1f5f9;
            border-radius: 20px;
            display: inline-block;
        }

        .stats-cards {
            display: grid;
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-3px);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-info h4 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-info p {
            font-size: 24px;
            font-weight: 700;
        }

        .streak-badge {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 15px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .streak-badge i {
            font-size: 32px;
        }

        .streak-badge div p {
            font-size: 20px;
            font-weight: 700;
            margin-top: 5px;
        }

        .user-info {
            background: #f8fafc;
            padding: 20px;
            border-radius: 20px;
        }

        .user-info h3 {
            margin-bottom: 15px;
            color: #1e293b;
            font-size: 18px;
        }

        .user-info p {
            margin-bottom: 10px;
            color: #475569;
            display: flex;
            align-items: center;
        }

        .user-info i {
            width: 25px;
            color: #667eea;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 15px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            color: #64748b;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #f1f5f9;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* –§–æ—Ä–º–∞ –±—ã—Å—Ç—Ä–æ–π –∑–∞–ø–∏—Å–∏ */
        .quick-entry {
            margin-top: 30px;
            background: #f8fafc;
            border-radius: 20px;
            padding: 20px;
        }

        .quick-entry h3 {
            margin-bottom: 15px;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideInDown 0.3s ease;
        }

        @keyframes slideInDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .notification.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .notification.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .notification.warning {
            background: #ffedd5;
            color: #9a3412;
            border: 1px solid #fed7aa;
        }

        .progress-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .form-group {
            position: relative;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .form-control.error {
            border-color: #ef4444;
            background-color: #fef2f2;
        }

        .input-hint {
            font-size: 11px;
            color: #94a3b8;
            margin-top: 5px;
            padding-left: 5px;
        }

        .btn-save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-save:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn-save:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* –ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤ */
        .history-list {
            display: grid;
            gap: 15px;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .history-list::-webkit-scrollbar {
            width: 8px;
        }

        .history-list::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }

        .history-list::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        .history-item {
            background: #f8fafc;
            border-radius: 20px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            border: 1px solid #e2e8f0;
        }

        .history-item:hover {
            transform: translateX(5px);
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .history-info h4 {
            color: #1e293b;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .history-info p {
            color: #64748b;
            font-size: 14px;
        }

        .history-calories {
            font-size: 20px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .delete-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            font-size: 16px;
            padding: 8px 12px;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .delete-btn:hover {
            background: #fee2e2;
        }

        .empty-state {
            text-align: center;
            color: #94a3b8;
            padding: 40px;
            background: #f8fafc;
            border-radius: 20px;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }

        .achievement-card {
            background: #f8fafc;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .achievement-card.unlocked {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
        }

        .achievement-card:not(.unlocked) {
            opacity: 0.7;
            filter: grayscale(0.5);
        }

        .achievement-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .achievement-name {
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .achievement-desc {
            font-size: 12px;
            opacity: 0.8;
        }

        .achievement-points {
            margin-top: 10px;
            font-size: 14px;
            font-weight: 600;
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .settings-form {
            max-width: 500px;
        }

        .settings-form .form-group {
            margin-bottom: 20px;
        }

        .settings-form label {
            display: block;
            margin-bottom: 8px;
            color: #334155;
            font-weight: 600;
            font-size: 14px;
        }

        .settings-form select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 15px;
        }

        /* –ì—Ä–∞—Ñ–∏–∫ */
        .chart-container {
            margin-top: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 20px;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .profile-grid {
                grid-template-columns: 1fr;
            }

            .navbar {
                flex-direction: column;
                gap: 15px;
            }

            .tabs {
                justify-content: center;
            }

            .progress-form {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="navbar">
            <a href="{{ url_for('index') }}" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-robot"></i>
                </div>
                <span>Calorie<span style="font-weight: 300;">AI</span></span>
            </a>
            <div class="nav-links">
                <a href="{{ url_for('index') }}" class="nav-link"><i class="fas fa-calculator"></i>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</a>
                <a href="#" class="nav-link active"><i class="fas fa-user"></i>–ü—Ä–æ—Ñ–∏–ª—å</a>
                <a href="{{ url_for('logout') }}" class="nav-link"><i class="fas fa-sign-out-alt"></i>–í—ã–π—Ç–∏</a>
            </div>
        </nav>

        <!-- Flash —Å–æ–æ–±—â–µ–Ω–∏—è -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">
                            <i class="fas {% if category == 'success' %}fa-check-circle{% elif category == 'danger' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %}"></i>
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
        <div class="profile-grid">
            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="sidebar">
                <div class="avatar-section">
                    <div class="avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="username">{{ user.username }}</div>
                    <div class="email">{{ user.email }}</div>
                    <div class="member-since">
                        <i class="far fa-calendar-alt"></i>
                        –° {{ user.created_at.strftime('%d.%m.%Y') }}
                    </div>
                </div>

                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div class="stat-info">
                            <h4>–í—Å–µ–≥–æ —Ä–∞—Å—á–µ—Ç–æ–≤</h4>
                            <p>{{ user.total_calculations }}</p>
                        </div>
                    </div>

                    {% if user.weight and user.goal %}
                    <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        <div class="stat-icon">
                            <i class="fas fa-bullseye"></i>
                        </div>
                        <div class="stat-info">
                            <h4>–¢–µ–∫—É—â–∞—è —Ü–µ–ª—å</h4>
                            <p>{% if user.goal == 'weight_loss' %}–ü–æ—Ö—É–¥–µ–Ω–∏–µ{% elif user.goal == 'muscle_gain' %}–ù–∞–±–æ—Ä –º–∞—Å—Å—ã{% else %}–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ{% endif %}</p>
                        </div>
                    </div>
                    {% endif %}
                </div>

                {% if streak > 0 %}
                <div class="streak-badge">
                    <i class="fas fa-fire"></i>
                    <div>
                        <small>–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</small>
                        <p>{{ streak }}</p>
                    </div>
                </div>
                {% endif %}

                <div class="user-info">
                    <h3><i class="fas fa-address-card"></i> –ú–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
                    {% if user.age %}
                    <p><i class="fas fa-birthday-cake"></i> –í–æ–∑—Ä–∞—Å—Ç: {{ user.age }} –ª–µ—Ç</p>
                    {% endif %}
                    {% if user.weight %}
                    <p><i class="fas fa-weight-scale"></i> –í–µ—Å: {{ user.weight }} –∫–≥</p>
                    {% endif %}
                    {% if user.height %}
                    <p><i class="fas fa-ruler"></i> –†–æ—Å—Ç: {{ user.height }} —Å–º</p>
                    {% endif %}
                    {% if not user.age and not user.weight and not user.height %}
                    <p style="color: #94a3b8; text-align: center;">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö</p>
                    {% endif %}
                </div>
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
            <div class="main-content">
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('overview')">üìä –û–±–∑–æ—Ä</div>
                    <div class="tab" onclick="switchTab('history')">üìú –ò—Å—Ç–æ—Ä–∏—è</div>
                    <div class="tab" onclick="switchTab('achievements')">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
                    <div class="tab" onclick="switchTab('settings')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                </div>

                <!-- –û–±–∑–æ—Ä -->
                <div id="overview" class="tab-content active">
                    <h2 style="margin-bottom: 20px;">–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ –Ω–µ–¥–µ–ª—é</h2>

                    {% if progress_data %}
                    <div class="chart-container">
                        <canvas id="progressChart"></canvas>
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞</p>
                        <p style="font-size: 14px; margin-top: 10px;">–ù–∞—á–Ω–∏—Ç–µ –≤–µ—Å—Ç–∏ –¥–Ω–µ–≤–Ω–∏–∫ –ø–∏—Ç–∞–Ω–∏—è, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</p>
                    </div>
                    {% endif %}

                    <!-- –ë—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å -->
                    <div class="quick-entry">
                        <h3>
                            <i class="fas fa-pen"></i>
                            –ë—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å
                        </h3>

                        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
                        <div id="notification" class="notification" style="display: none;">
                            <i class="fas" id="notificationIcon"></i>
                            <span id="notificationMessage"></span>
                        </div>

                        <form id="progressForm" class="progress-form" onsubmit="return false;">
                            <div class="form-group">
                                <input type="number"
                                       class="form-control"
                                       placeholder="–í–µ—Å (–∫–≥)"
                                       name="weight"
                                       id="weightInput"
                                       step="0.1"
                                       min="30"
                                       max="250"
                                       oninput="validateNumber(this)">
                                <div class="input-hint">30-250 –∫–≥</div>
                            </div>

                            <div class="form-group">
                                <input type="number"
                                       class="form-control"
                                       placeholder="–ö–∞–ª–æ—Ä–∏–∏"
                                       name="calories"
                                       id="caloriesInput"
                                       min="0"
                                       max="10000"
                                       oninput="validateNumber(this)">
                                <div class="input-hint">0-10000 –∫–∫–∞–ª</div>
                            </div>

                            <div class="form-group">
                                <input type="number"
                                       class="form-control"
                                       placeholder="–í–æ–¥–∞ (–ª)"
                                       name="water"
                                       id="waterInput"
                                       step="0.1"
                                       min="0"
                                       max="10"
                                       oninput="validateNumber(this)">
                                <div class="input-hint">0-10 –ª–∏—Ç—Ä–æ–≤</div>
                            </div>

                            <div class="form-group">
                                <input type="number"
                                       class="form-control"
                                       placeholder="–®–∞–≥–∏"
                                       name="steps"
                                       id="stepsInput"
                                       min="0"
                                       max="100000"
                                       oninput="validateNumber(this)">
                                <div class="input-hint">0-100000 —à–∞–≥–æ–≤</div>
                            </div>

                            <div class="form-group">
                                <select class="form-control" name="mood" id="moodSelect">
                                    <option value="">üé≠ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</option>
                                    <option value="5">üòä –û—Ç–ª–∏—á–Ω–æ–µ</option>
                                    <option value="4">üôÇ –•–æ—Ä–æ—à–µ–µ</option>
                                    <option value="3">üòê –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ</option>
                                    <option value="2">üòï –ü–ª–æ—Ö–æ–µ</option>
                                    <option value="1">üò´ –£–∂–∞—Å–Ω–æ–µ</option>
                                </select>
                            </div>

                            <button type="button" class="btn-save" onclick="validateAndSaveProgress()" id="saveButton">
                                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            </button>
                        </form>
                    </div>
                </div>

                <!-- –ò—Å—Ç–æ—Ä–∏—è -->
                <div id="history" class="tab-content">
                    <h2 style="margin-bottom: 20px;">–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤</h2>

                    <div class="history-list" id="historyList">
                        {% if calculations %}
                            {% for calc in calculations %}
                            <div class="history-item" id="calc-{{ calc.id }}">
                                <div class="history-info">
                                    <h4>{{ calc.date.strftime('%d.%m.%Y %H:%M') }}</h4>
                                    <p>
                                        –í–µ—Å: {{ calc.weight }} –∫–≥ |
                                        {% if calc.goal == 'weight_loss' %}–ü–æ—Ö—É–¥–µ–Ω–∏–µ
                                        {% elif calc.goal == 'muscle_gain' %}–ù–∞–±–æ—Ä –º–∞—Å—Å—ã
                                        {% else %}–ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ{% endif %}
                                    </p>
                                    <p style="font-size: 12px; color: #94a3b8;">
                                        –ë:{{ calc.protein }} –ñ:{{ calc.fats }} –£:{{ calc.carbs }}
                                    </p>
                                </div>
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <div class="history-calories">{{ calc.recommended_calories }} –∫–∫–∞–ª</div>
                                    <button class="delete-btn" onclick="deleteHistory({{ calc.id }})" title="–£–¥–∞–ª–∏—Ç—å">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="empty-state">
                                <i class="fas fa-history"></i>
                                <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤</p>
                                <p style="font-size: 14px; margin-top: 10px;">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, —á—Ç–æ–±—ã –ø–æ—è–≤–∏–ª–∞—Å—å –∏—Å—Ç–æ—Ä–∏—è</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
                <div id="achievements" class="tab-content">
                    <h2 style="margin-bottom: 20px;">–ú–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>

                    <div class="achievements-grid">
                        {% for ach in achievements %}
                        <div class="achievement-card {% if ach.name in user_achievements %}unlocked{% endif %}">
                            <div class="achievement-icon">{{ ach.icon }}</div>
                            <div class="achievement-name">{{ ach.name }}</div>
                            <div class="achievement-desc">{{ ach.description }}</div>
                            {% if ach.name in user_achievements %}
                            <div class="achievement-points">
                                <i class="fas fa-check-circle"></i> –ü–æ–ª—É—á–µ–Ω–æ
                            </div>
                            {% else %}
                            <div class="achievement-points">
                                <i class="fas fa-star"></i> {{ ach.points }} –æ—á–∫–æ–≤
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>

               <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
<div id="settings" class="tab-content">
    <h2 style="margin-bottom: 20px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h2>

    <!-- –í–∏–¥–∂–µ—Ç –ò–ú–¢ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ -->
    <div id="liveBMIContainer" style="margin-bottom: 25px; display: none;">
        <div class="bmi-live-card" id="liveBMICard" style="padding: 20px; border-radius: 20px; transition: all 0.3s;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; background: rgba(255,255,255,0.2);" id="liveBMIIcon">
                    ‚öñÔ∏è
                </div>
                <div style="flex: 1;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="font-size: 16px; font-weight: 600;">–í–∞—à –ò–ú–¢ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</h3>
                        <span style="font-size: 28px; font-weight: 800;" id="liveBMIValue">0</span>
                    </div>
                    <div style="font-size: 14px; font-weight: 500; margin: 5px 0;" id="liveBMICategory">–í–≤–µ–¥–∏—Ç–µ –≤–µ—Å –∏ —Ä–æ—Å—Ç</div>
                    <div style="font-size: 12px; color: #64748b;" id="liveBMIRisk"></div>
                </div>
            </div>

            <!-- –ú–∏–Ω–∏-–ø–æ–¥—Å–∫–∞–∑–∫–∞ -->
            <div style="margin-top: 10px; font-size: 12px; padding: 8px; background: rgba(255,255,255,0.3); border-radius: 10px;" id="liveBMIAdvice">
                –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤–µ—Å –∏ —Ä–æ—Å—Ç —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
            </div>

            <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è —à–∫–∞–ª–∞ –ò–ú–¢ (—É–º–µ–Ω—å—à–µ–Ω–Ω–∞—è) -->
            <div style="margin-top: 15px;">
                <div style="display: flex; justify-content: space-between; font-size: 8px; color: #94a3b8; margin-bottom: 3px;">
                    <span>16</span><span>18.5</span><span>25</span><span>30</span><span>35</span><span>40</span>
                </div>
                <div style="height: 8px; background: linear-gradient(90deg, #ef4444 0%, #f59e0b 16%, #10b981 30%, #f59e0b 50%, #ef4444 65%, #dc2626 80%, #7f1d1d 100%); border-radius: 10px; position: relative;">
                    <div id="liveBMIMarker" style="position: absolute; width: 4px; height: 16px; background: white; border: 2px solid #1e293b; border-radius: 4px; top: -4px; transform: translateX(-50%); transition: left 0.3s;"></div>
                </div>
            </div>
        </div>
    </div>

    <form class="settings-form" method="POST" action="{{ url_for('update_profile') }}" onsubmit="return validateSettings()">
        <div class="form-group">
            <label>–í–æ–∑—Ä–∞—Å—Ç (–ª–µ—Ç)</label>
            <input type="number" class="form-control" name="age" id="settingsAge" value="{{ user.age or '' }}" min="15" max="100" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 30" oninput="updateLiveBMI()">
        </div>

        <div class="form-group">
            <label>–í–µ—Å (–∫–≥)</label>
            <input type="number" class="form-control" name="weight" id="settingsWeight" value="{{ user.weight or '' }}" step="0.1" min="30" max="250" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 70.5" oninput="updateLiveBMI()">
        </div>

        <div class="form-group">
            <label>–†–æ—Å—Ç (—Å–º)</label>
            <input type="number" class="form-control" name="height" id="settingsHeight" value="{{ user.height or '' }}" min="100" max="250" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 170" oninput="updateLiveBMI()">
        </div>

        <div class="form-group">
            <label>–ü–æ–ª</label>
            <select class="form-control" name="gender" id="settingsGender" onchange="updateLiveBMI()">
                <option value="male" {% if user.gender == 'male' %}selected{% endif %}>–ú—É–∂—Å–∫–æ–π</option>
                <option value="female" {% if user.gender == 'female' %}selected{% endif %}>–ñ–µ–Ω—Å–∫–∏–π</option>
            </select>
        </div>

        <div class="form-group">
            <label>–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</label>
            <select class="form-control" name="activity">
                <option value="sedentary" {% if user.activity_level == 'sedentary' %}selected{% endif %}>ü™ë –°–∏–¥—è—á–∏–π</option>
                <option value="light" {% if user.activity_level == 'light' %}selected{% endif %}>üö∂ –õ–µ–≥–∫–∏–π</option>
                <option value="moderate" {% if user.activity_level == 'moderate' %}selected{% endif %}>üèÉ –£–º–µ—Ä–µ–Ω–Ω—ã–π</option>
                <option value="active" {% if user.activity_level == 'active' %}selected{% endif %}>üí™ –ê–∫—Ç–∏–≤–Ω—ã–π</option>
                <option value="very_active" {% if user.activity_level == 'very_active' %}selected{% endif %}>‚ö° –û—á–µ–Ω—å –∞–∫—Ç–∏–≤–Ω—ã–π</option>
            </select>
        </div>

        <div class="form-group">
            <label>–¶–µ–ª—å</label>
            <select class="form-control" name="goal">
                <option value="weight_loss" {% if user.goal == 'weight_loss' %}selected{% endif %}>üéØ –ü–æ—Ö—É–¥–µ–Ω–∏–µ</option>
                <option value="maintenance" {% if user.goal == 'maintenance' %}selected{% endif %}>‚öñÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ</option>
                <option value="muscle_gain" {% if user.goal == 'muscle_gain' %}selected{% endif %}>üí™ –ù–∞–±–æ—Ä –º–∞—Å—Å—ã</option>
            </select>
        </div>

        <button type="submit" class="btn-save" style="width: 100%;">
            <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
        </button>
    </form>
</div>
            </div>
        </div>
    </div>

    <script>




        // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –ò–ú–¢
function calculateBMI(weight, height) {
    if (!weight || !height || weight <= 0 || height <= 0) return null;
    const heightM = height / 100;
    return weight / (heightM * heightM);
}

// –§—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ò–ú–¢
function getBMICategory(bmi) {
    if (bmi < 16.0) {
        return {
            category: '–í—ã—Ä–∞–∂–µ–Ω–Ω—ã–π –¥–µ—Ñ–∏—Ü–∏—Ç',
            risk: '–ö—Ä–∞–π–Ω–µ –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫',
            color: '#ef4444',
            icon: '‚ö†Ô∏è',
            advice: '–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –≤—Ä–∞—á–∞'
        };
    } else if (bmi < 18.5) {
        return {
            category: '–î–µ—Ñ–∏—Ü–∏—Ç –≤–µ—Å–∞',
            risk: '–ü–æ–≤—ã—à–µ–Ω–Ω—ã–π —Ä–∏—Å–∫',
            color: '#f59e0b',
            icon: '‚ö°',
            advice: '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞–±—Ä–∞—Ç—å –≤–µ—Å'
        };
    } else if (bmi < 25.0) {
        return {
            category: '–ù–æ—Ä–º–∞–ª—å–Ω—ã–π –≤–µ—Å',
            risk: '–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫',
            color: '#10b981',
            icon: '‚úÖ',
            advice: '–û—Ç–ª–∏—á–Ω—ã–π –≤–µ—Å!'
        };
    } else if (bmi < 30.0) {
        return {
            category: '–ò–∑–±—ã—Ç–æ—á–Ω—ã–π –≤–µ—Å',
            risk: '–£–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–∏—Å–∫',
            color: '#f59e0b',
            icon: '‚ö†Ô∏è',
            advice: '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–Ω–∏–∑–∏—Ç—å –≤–µ—Å'
        };
    } else if (bmi < 35.0) {
        return {
            category: '–û–∂–∏—Ä–µ–Ω–∏–µ I —Å—Ç–µ–ø–µ–Ω–∏',
            risk: '–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫',
            color: '#ef4444',
            icon: 'üî¥',
            advice: '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Å–∞'
        };
    } else if (bmi < 40.0) {
        return {
            category: '–û–∂–∏—Ä–µ–Ω–∏–µ II —Å—Ç–µ–ø–µ–Ω–∏',
            risk: '–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫',
            color: '#dc2626',
            icon: 'üÜò',
            advice: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –≤—Ä–∞—á–∞'
        };
    } else {
        return {
            category: '–û–∂–∏—Ä–µ–Ω–∏–µ III —Å—Ç–µ–ø–µ–Ω–∏',
            risk: '–ö—Ä–∞–π–Ω–µ –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫',
            color: '#7f1d1d',
            icon: 'üö®',
            advice: '–°—Ä–æ—á–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –≤—Ä–∞—á–∞'
        };
    }
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è live –ò–ú–¢
function updateLiveBMI() {
    const weight = parseFloat(document.getElementById('settingsWeight').value);
    const height = parseFloat(document.getElementById('settingsHeight').value);
    const age = document.getElementById('settingsAge').value;
    const gender = document.getElementById('settingsGender').value;

    const container = document.getElementById('liveBMIContainer');
    const bmiValue = document.getElementById('liveBMIValue');
    const bmiCategory = document.getElementById('liveBMICategory');
    const bmiRisk = document.getElementById('liveBMIRisk');
    const bmiAdvice = document.getElementById('liveBMIAdvice');
    const bmiIcon = document.getElementById('liveBMIIcon');
    const bmiCard = document.getElementById('liveBMICard');
    const bmiMarker = document.getElementById('liveBMIMarker');

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –ª–∏ –≤–µ—Å –∏ —Ä–æ—Å—Ç
    if (weight && height && !isNaN(weight) && !isNaN(height) && weight > 0 && height > 0) {
        const bmi = calculateBMI(weight, height);
        const category = getBMICategory(bmi);

        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
        bmiValue.textContent = bmi.toFixed(1);
        bmiCategory.textContent = category.category;
        bmiRisk.textContent = category.risk;
        bmiAdvice.textContent = category.advice;
        bmiIcon.innerHTML = category.icon;

        // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
        bmiCard.style.background = category.color + '20';
        bmiCard.style.border = '2px solid ' + category.color;

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –º–∞—Ä–∫–µ—Ä–∞ –Ω–∞ —à–∫–∞–ª–µ
        let position = 0;
        if (bmi < 16) position = 0;
        else if (bmi > 40) position = 100;
        else position = ((bmi - 16) / (40 - 16)) * 100;
        bmiMarker.style.left = position + '%';

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        container.style.display = 'block';

        // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–∑—Ä–∞—Å—Ç–∞ –∏ –ø–æ–ª–∞
        let personalAdvice = '';
        if (age) {
            if (age < 18) {
                personalAdvice = ' –î–ª—è –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤ –Ω–æ—Ä–º—ã –ò–ú–¢ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è. –ü—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π—Ç–µ—Å—å —Å –≤—Ä–∞—á–æ–º.';
            } else if (age > 65) {
                personalAdvice = ' –î–ª—è –ø–æ–∂–∏–ª—ã—Ö –ª—é–¥–µ–π –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–µ–±–æ–ª—å—à–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ –ò–ú–¢.';
            }
        }

        if (gender === 'female' && bmi > 27 && bmi < 30) {
            personalAdvice += ' –£ –∂–µ–Ω—â–∏–Ω –≤ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥ –ò–ú–¢ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–º–Ω–æ–≥–æ –≤—ã—à–µ –Ω–æ—Ä–º—ã.';
        }

        bmiAdvice.innerHTML = category.advice + (personalAdvice ? '<br><small>' + personalAdvice + '</small>' : '');
    } else {
        // –ï—Å–ª–∏ –ø–æ–ª—è –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã, —Å–∫—Ä—ã–≤–∞–µ–º –∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
        if (!weight && !height) {
            container.style.display = 'none';
        } else {
            container.style.display = 'block';
            bmiCard.style.background = '#f1f5f9';
            bmiCard.style.border = '2px solid #cbd5e1';
            bmiValue.textContent = '?';
            bmiCategory.textContent = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ';
            bmiRisk.textContent = '';
            bmiAdvice.textContent = '–í–µ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 30 –¥–æ 250 –∫–≥, —Ä–æ—Å—Ç –æ—Ç 100 –¥–æ 250 —Å–º';
            bmiIcon.innerHTML = '‚öñÔ∏è';
            bmiMarker.style.left = '50%';
        }
    }
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
function validateSettings() {
    const weight = document.getElementById('settingsWeight').value;
    const height = document.getElementById('settingsHeight').value;
    const age = document.getElementById('settingsAge').value;

    if (weight && (weight < 30 || weight > 250)) {
        showNotification('–í–µ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 30 –¥–æ 250 –∫–≥', 'error');
        return false;
    }

    if (height && (height < 100 || height > 250)) {
        showNotification('–†–æ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 100 –¥–æ 250 —Å–º', 'error');
        return false;
    }

    if (age && (age < 15 || age > 100)) {
        showNotification('–í–æ–∑—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 15 –¥–æ 100 –ª–µ—Ç', 'error');
        return false;
    }

    return true;
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ò–ú–¢ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    updateLiveBMI();
});
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è —á–∏—Å–µ–ª
        function validateNumber(input) {
            input.value = input.value.replace(/[^\d.]/g, '');

            const dots = input.value.match(/\./g);
            if (dots && dots.length > 1) {
                input.value = input.value.slice(0, -1);
            }

            input.classList.remove('error');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notificationIcon');
            const messageEl = document.getElementById('notificationMessage');

            notification.className = 'notification ' + type;

            if (type === 'success') {
                icon.className = 'fas fa-check-circle';
            } else if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle';
            } else {
                icon.className = 'fas fa-exclamation-triangle';
            }

            messageEl.textContent = message;
            notification.style.display = 'flex';

            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        async function validateAndSaveProgress() {
            const weightInput = document.getElementById('weightInput');
            const caloriesInput = document.getElementById('caloriesInput');
            const waterInput = document.getElementById('waterInput');
            const stepsInput = document.getElementById('stepsInput');
            const moodSelect = document.getElementById('moodSelect');
            const saveButton = document.getElementById('saveButton');

            // –°–±—Ä–æ—Å –æ—à–∏–±–æ–∫
            [weightInput, caloriesInput, waterInput, stepsInput].forEach(input => {
                if (input) input.classList.remove('error');
            });

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—å –∫–∞–∫–∏–µ-—Ç–æ –¥–∞–Ω–Ω—ã–µ
            let hasData = false;
            const errors = [];
            const data = {};

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Å–∞
            if (weightInput.value && weightInput.value.trim() !== '') {
                const weight = parseFloat(weightInput.value);
                if (isNaN(weight)) {
                    errors.push('–í–µ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º');
                    weightInput.classList.add('error');
                } else if (weight < 30 || weight > 250) {
                    errors.push('–í–µ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 30 –¥–æ 250 –∫–≥');
                    weightInput.classList.add('error');
                } else {
                    data.weight = weight;
                    hasData = true;
                }
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–ª–æ—Ä–∏–π
            if (caloriesInput.value && caloriesInput.value.trim() !== '') {
                const calories = parseFloat(caloriesInput.value);
                if (isNaN(calories)) {
                    errors.push('–ö–∞–ª–æ—Ä–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–æ–º');
                    caloriesInput.classList.add('error');
                } else if (calories < 0 || calories > 10000) {
                    errors.push('–ö–∞–ª–æ—Ä–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç 0 –¥–æ 10000');
                    caloriesInput.classList.add('error');
                } else {
                    data.calories = calories;
                    hasData = true;
                }
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–¥—ã
            if (waterInput.value && waterInput.value.trim() !== '') {
                const water = parseFloat(waterInput.value);
                if (isNaN(water)) {
                    errors.push('–í–æ–¥–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º');
                    waterInput.classList.add('error');
                } else if (water < 0 || water > 10) {
                    errors.push('–í–æ–¥–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 0 –¥–æ 10 –ª–∏—Ç—Ä–æ–≤');
                    waterInput.classList.add('error');
                } else {
                    data.water = water;
                    hasData = true;
                }
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∞–≥–æ–≤
            if (stepsInput.value && stepsInput.value.trim() !== '') {
                const steps = parseInt(stepsInput.value);
                if (isNaN(steps)) {
                    errors.push('–®–∞–≥–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–æ–º');
                    stepsInput.classList.add('error');
                } else if (steps < 0 || steps > 100000) {
                    errors.push('–®–∞–≥–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç 0 –¥–æ 100000');
                    stepsInput.classList.add('error');
                } else {
                    data.steps = steps;
                    hasData = true;
                }
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
            if (moodSelect.value && moodSelect.value !== '') {
                data.mood = parseInt(moodSelect.value);
                hasData = true;
            }

            // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö
            if (!hasData) {
                showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –ø–æ–ª–µ', 'warning');
                return;
            }

            // –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏
            if (errors.length > 0) {
                showNotification(errors.join('. '), 'error');
                return;
            }

            // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            try {
                saveButton.disabled = true;
                saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';

                const response = await fetch('/save_progress', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    showNotification('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');

                    // –û—á–∏—â–∞–µ–º –ø–æ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                    // weightInput.value = '';
                    // caloriesInput.value = '';
                    // waterInput.value = '';
                    // stepsInput.value = '';
                    // moodSelect.value = '';

                    // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                    location.reload(); // –í—Ä–µ–º–µ–Ω–Ω–æ, –ø–æ—Ç–æ–º –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                } else {
                    showNotification('–û—à–∏–±–∫–∞: ' + result.error, 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            } finally {
                saveButton.disabled = false;
                saveButton.innerHTML = '<i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
        async function deleteHistory(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ä–∞—Å—á–µ—Ç –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏?')) return;

            try {
                const response = await fetch(`/delete_history/${id}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById(`calc-${id}`).remove();
                    showNotification('–ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞', 'success');

                    // –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
                    if (document.querySelectorAll('.history-item').length === 0) {
                        document.getElementById('historyList').innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-history"></i>
                                <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤</p>
                            </div>
                        `;
                    }
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏', 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
        {% if progress_data %}
        document.addEventListener('DOMContentLoaded', function() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [{% for p in progress_data %}'{{ p.date.strftime("%d.%m") }}',{% endfor %}],
                    datasets: [
                        {
                            label: '–í–µ—Å (–∫–≥)',
                            data: [{% for p in progress_data %}{{ p.weight or 'null' }},{% endfor %}],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#667eea',
                            pointBorderColor: 'white',
                            pointBorderWidth: 2,
                            pointRadius: 5,
                            pointHoverRadius: 7
                        },
                        {
                            label: '–ö–∞–ª–æ—Ä–∏–∏',
                            data: [{% for p in progress_data %}{{ p.calories_consumed or 'null' }},{% endfor %}],
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#f59e0b',
                            pointBorderColor: 'white',
                            pointBorderWidth: 2,
                            pointRadius: 5,
                            pointHoverRadius: 7,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#1e293b',
                            bodyColor: '#475569',
                            borderColor: '#e2e8f0',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: '–í–µ—Å (–∫–≥)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: '–ö–∞–ª–æ—Ä–∏–∏'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        });
        {% endif %}

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ flash —Å–æ–æ–±—â–µ–Ω–∏–π
        setTimeout(() => {
            document.querySelectorAll('.alert').forEach(alert => {
                alert.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => alert.remove(), 300);
            });
        }, 5000);

        // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideOutRight {
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>